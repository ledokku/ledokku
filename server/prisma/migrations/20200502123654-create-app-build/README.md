# Migration `20200502123654-create-app-build`

This migration has been generated by pradel at 5/2/2020, 12:36:54 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "AppBuildStatus" AS ENUM ('PENDING', 'IN_PROGRESS', 'COMPLETED', 'ERRORED');

CREATE TABLE "public"."AppBuild" (
"appId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"serverId" text  NOT NULL ,"status" "AppBuildStatus" NOT NULL ,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."AppBuild" ADD FOREIGN KEY ("serverId")REFERENCES "public"."Server"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AppBuild" ADD FOREIGN KEY ("appId")REFERENCES "public"."App"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AppBuild" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200430164954-format..20200502123654-create-app-build
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,8 +21,9 @@
   sshKeys                 SshKey[]
   Action                  Action[]
   App                     App[]
   Database                Database[]
+  AppBuild                AppBuild[]
 }
 model SshKey {
   id             String   @default(uuid()) @id
@@ -51,8 +52,9 @@
   sshKeyId  String
   Action    Action[]
   App       App[]
   Database  Database[]
+  AppBuild  AppBuild[]
 }
 enum ServerTypes {
   AWS
@@ -91,20 +93,41 @@
 }
 // Link database to app
 model App {
-  id            String   @default(uuid()) @id
-  createdAt     DateTime @default(now())
-  updatedAt     DateTime @default(now())
+  id            String     @default(uuid()) @id
+  createdAt     DateTime   @default(now())
+  updatedAt     DateTime   @default(now())
   name          String
   githubRepoUrl String
   githubId      String
-  user          User     @relation(fields: [userId], references: [id])
+  user          User       @relation(fields: [userId], references: [id])
   userId        String
-  server        Server   @relation(fields: [serverId], references: [id])
+  server        Server     @relation(fields: [serverId], references: [id])
   serverId      String
+  appBuild      AppBuild[]
 }
+model AppBuild {
+  id        String         @default(uuid()) @id
+  createdAt DateTime       @default(now())
+  updatedAt DateTime       @default(now())
+  status    AppBuildStatus
+  server    Server         @relation(fields: [serverId], references: [id])
+  serverId  String
+  app       App            @relation(fields: [appId], references: [id])
+  appId     String
+  user      User           @relation(fields: [userId], references: [id])
+  userId    String
+}
+
+enum AppBuildStatus {
+  PENDING
+  IN_PROGRESS
+  COMPLETED
+  ERRORED
+}
+
 model Database {
   id        String   @default(uuid()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
```
