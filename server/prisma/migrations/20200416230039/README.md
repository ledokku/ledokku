# Migration `20200416230039`

This migration has been generated by pradel at 4/16/2020, 11:00:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "ServerTypes" AS ENUM ('AWS', 'DIGITALOCEAN', 'LINODE');

CREATE TYPE "ServerStates" AS ENUM ('NEW', 'ACTIVE', 'OFF', 'ARCHIVE');

CREATE TYPE "ActionStatus" AS ENUM ('PENDING', 'IN_PROGRESS', 'COMPLETED', 'ERRORED');

CREATE TYPE "ActionType" AS ENUM ('SETUP_SERVER');

CREATE TYPE "DbTypes" AS ENUM ('REDIS', 'POSTGRESQL', 'MONGODB');

CREATE TABLE "public"."User" (
    "avatarUrl" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "digitaloceanAccessToken" text   ,
    "email" text  NOT NULL ,
    "githubAccessToken" text  NOT NULL ,
    "githubId" text  NOT NULL ,
    "id" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "username" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "public"."SshKey" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "digitaloceanId" integer  NOT NULL ,
    "id" text  NOT NULL ,
    "privateKey" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "public"."Server" (
    "actionId" integer   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "ip" text   ,
    "name" text  NOT NULL ,
    "serverId" integer  NOT NULL ,
    "sshKeyId" text  NOT NULL ,
    "type" "ServerTypes" NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "public"."Action" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "serverId" text  NOT NULL ,
    "status" "ActionStatus" NOT NULL ,
    "type" "ActionType" NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "public"."App" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "githubId" text  NOT NULL ,
    "githubRepoUrl" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "serverId" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "public"."Database" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "serverId" text  NOT NULL ,
    "type" "DbTypes" NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.githubId" ON "public"."User"("githubId")

ALTER TABLE "public"."SshKey" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Server" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Server" ADD FOREIGN KEY ("sshKeyId")REFERENCES "public"."SshKey"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Action" ADD FOREIGN KEY ("serverId")REFERENCES "public"."Server"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Action" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."App" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."App" ADD FOREIGN KEY ("serverId")REFERENCES "public"."Server"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Database" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Database" ADD FOREIGN KEY ("serverId")REFERENCES "public"."Server"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200416230039
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,116 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id                      String   @default(uuid()) @id
+  createdAt               DateTime @default(now())
+  updatedAt               DateTime @default(now())
+  username                String   @unique
+  avatarUrl               String
+  email                   String
+  githubId                String   @unique
+  githubAccessToken       String
+  digitaloceanAccessToken String?
+  servers                 Server[]
+  sshKeys                 SshKey[]
+}
+
+model SshKey {
+  id             String   @default(uuid()) @id
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @default(now())
+  privateKey     String
+  digitaloceanId Int
+  servers        Server[]
+  user           User     @relation(fields: [userId], references: [id])
+  userId         String
+}
+
+model Server {
+  id          String      @default(uuid()) @id
+  createdAt   DateTime    @default(now())
+  updatedAt   DateTime    @default(now())
+  serverId    Int
+  ip          String?
+  name        String
+  type        ServerTypes
+  actionId    Int?
+  user        User        @relation(fields: [userId], references: [id])
+  userId      String
+  sshKey      SshKey      @relation(fields: [sshKeyId], references: [id])
+  sshKeyId    String
+}
+
+enum ServerTypes {
+  AWS
+  DIGITALOCEAN
+  LINODE
+}
+
+enum ServerStates {
+  NEW
+  ACTIVE
+  OFF
+  ARCHIVE
+}
+
+model Action {
+  id             String   @default(uuid()) @id
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @default(now())
+  status         ActionStatus
+  type           ActionType
+  server         Server   @relation(fields: [serverId], references: [id])
+  serverId       String
+  user           User     @relation(fields: [userId], references: [id])
+  userId         String
+}
+
+enum ActionStatus {
+  PENDING
+  IN_PROGRESS
+  COMPLETED
+  ERRORED
+}
+
+enum ActionType {
+  SETUP_SERVER
+}
+
+// Link database to app
+model App {
+  id            String   @default(uuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @default(now())
+  name          String
+  githubRepoUrl String
+  githubId      String
+  user          User     @relation(fields: [userId], references: [id])
+  userId        String
+  server        Server   @relation(fields: [serverId], references: [id])
+  serverId      String
+}
+
+model Database {
+  id        String   @default(uuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now())
+  name      String
+  type      DbTypes
+  user      User     @relation(fields: [userId], references: [id])
+  userId    String
+  server    Server   @relation(fields: [serverId], references: [id])
+  serverId  String
+}
+
+enum DbTypes {
+  REDIS
+  POSTGRESQL
+  MONGODB
+}
```
